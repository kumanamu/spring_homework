<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원 관리</title>
  <script>
    async function loadUsers() {
        const res = await fetch('/users/all');
        const users = await res.json();
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';
        users.forEach(u => {
            tbody.innerHTML += `
            <tr>
                <td>${u.id}</td>
                <td>${u.username}</td>
                <td>${u.email}</td>
                <td>${u.admin}</td>
                <td>${u.status}</td>
                <td>
                    ${u.status === 'PENDING' ? `<button onclick="approveUser(${u.id})">승인</button>` : ''}
                </td>
            </tr>`;
        });
    }

    async function approveUser(id) {
        await fetch(`/users/approve/${id}`, { method: 'PUT' });
        loadUsers();
    }

    window.onload = loadUsers;
  </script>
</head>
<body>
<h1>회원 관리 페이지 (관리자용)</h1>
<table border="1">
  <tr>
    <th>ID</th>
    <th>Username</th>
    <th>Email</th>
    <th>Status</th>
    <th>Action</th>
  </tr>
  <tr th:each="user : ${users}">
    <td th:text="${user.id}"></td>
    <td th:text="${user.username}"></td>
    <td th:text="${user.email}"></td>
    <td th:text="${user.status}"></td>
    <td>
      <form th:action="@{/users/approve/{id}(id=${user.id})}" method="post">
        <button type="submit" th:if="${user.status == 'PENDING'}">승인</button>
        <span th:if="${user.status == 'APPROVED'}">승인 완료</span>
      </form>
    </td>
  </tr>
</body>
</html>
